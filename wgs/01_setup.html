<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>01. Environment Setup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    pre { position: relative; background: #f8f9fa; padding: 1rem; border-radius: 6px; }
    .copy-btn { position: absolute; top: 6px; right: 6px; font-size: 0.8rem; }
    code { white-space: pre; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-primary">Step 01. Environment Setup</h1>
    <p class="lead">
      분석을 시작하기 전에 <b>Conda</b> 환경과 필수 툴을 설치하고, 레퍼런스 유전체 파일을 준비합니다.
      앞으로 모든 분석은 <b>20 threads</b>를 기본으로 사용합니다.
    </p>
    <hr/>

    <!-- (1) Conda 환경 생성 -->
    <h3>1) Conda 환경 생성</h3>
    <p>
      <b>Conda</b>는 파이썬/비파이썬 패키지를 함께 관리하는 패키지 & 가상환경 관리자입니다.
      서로 다른 프로젝트에서 <i>툴 버전 충돌</i>을 피하려면 각 프로젝트마다 별도의 conda 환경을 만드는 것이 안전합니다.
      생정보 툴은 대부분 <code>bioconda</code>와 <code>conda-forge</code> 채널에서 설치합니다.
    </p>
    <pre><button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyCode(this)">Copy</button><code>
# 채널 추가 (추천 순서)
conda config --add channels conda-forge
conda config --add channels bioconda
conda config --set channel_priority strict

# 환경 생성 (python3.10 + 주요 패키지)
conda create -y -n wgs_env python=3.10 \
  cutadapt bwa samtools gatk4 bcftools bedtools fastqc multiqc \
  openjdk=17 parallel

# 환경 활성화
conda activate wgs_env
</code></pre>

    <!-- (2) 디렉토리 구조 -->
    <h3 class="mt-4">2) 디렉토리 구조 예시</h3>
    <p>분석 데이터를 관리하기 위해 아래와 같은 디렉토리 구조를 추천합니다.</p>
    <pre><button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyCode(this)">Copy</button><code>
/home/kang/
 ├── raw_data/                 # 원본 데이터 및 reference
 │   └── gatk_bundle/          # GATK 번들(레퍼런스/known-sites 등)
 ├── God_Nas/WGS_2nd/          # 프로젝트 폴더
 │   └── Trimmed_fastq/        # 트리밍된 FASTQ 저장
 └── ...
</code></pre>

    <!-- (3) Reference Genome 준비 -->
    <h3 class="mt-4">3) Reference Genome 준비</h3>
    <p>
      본 실습에서는 <b>Homo_sapiens_assembly38.fasta (GRCh38/hg38)</b>를 사용합니다.
      WGS 분석에서 모든 read는 기준(reference) 유전체에 정렬되므로,
      <b>공식 레퍼런스</b>와 <b>known-sites 리소스</b>(dbSNP, HapMap, Mills indels 등)를 정확히 준비하는 것이 중요합니다.
    </p>
    <p>
      GATK Best Practices에서는 <b>GATK Resource Bundle</b> 사용을 권장합니다.
      이 번들은 Broad Institute에서 제공하는 표준 리소스 모음으로,
      <code>hg19</code>, <code>hg38</code>에 대한 레퍼런스와 각종 VCF/interval 파일을 포함합니다.
      현재 Google Cloud Storage(GCS)에 호스팅되어 있어 웹 또는 <code>gsutil</code>로 받을 수 있습니다.
    </p>

    <h5>GATK Resource Bundle 다운로드 (hg38 예시)</h5>
    <pre><button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyCode(this)">Copy</button><code>
# (선택) Google Cloud SDK 설치
conda install -y -c conda-forge google-cloud-sdk

# hg38 번들을 로컬로 복사 (예: /home/kang/raw_data/gatk_bundle/ 아래)
gsutil -m cp -r gs://genomics-public-data/references/broad/hg38/v0/ \
  /home/kang/raw_data/gatk_bundle/
</code></pre>

    <p class="mt-2">
      다운로드 후, GATK 및 정렬 도구에서 사용할 색인을 생성합니다.
      필요한 파일은 <code>.fasta</code>(염기서열), <code>.fai</code>(faidx 색인), <code>.dict</code>(GATK 딕셔너리)입니다.
    </p>
    <pre><button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyCode(this)">Copy</button><code>
# Reference 경로 지정 (다운로드한 번들 내부 경로에 맞게 조정)
REF_DIR=/home/kang/raw_data/gatk_bundle/v0
REF=${REF_DIR}/Homo_sapiens_assembly38.fasta

# 색인 생성 (한 번만)
bwa index ${REF}
samtools faidx ${REF}
gatk CreateSequenceDictionary -R ${REF} -O ${REF%.fasta}.dict
</code></pre>

    <!-- (4) Thread 설정 -->
    <h3 class="mt-4">4) Thread 설정</h3>
    <p>분석은 기본적으로 <b>20 threads</b>를 사용합니다. 스크립트 상단에 변수를 선언해 두면 일괄 적용하기 편합니다.</p>
    <pre><button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyCode(this)">Copy</button><code>
# 앞으로 모든 스크립트 상단에 공통 선언
THREADS=20
</code></pre>

    <!-- nav buttons -->
    <div class="mt-4 d-flex gap-2">
      <a class="btn btn-outline-secondary" href="index.html">← Back to WGS Tutorial</a>
      <a class="btn btn-primary" href="02_trimming.html">Next: Trimming →</a>
    </div>
  </div>

  <script>
    function copyCode(btn){
      const code = btn.nextElementSibling.innerText;
      navigator.clipboard.writeText(code).then(()=>{
        const old = btn.innerText; btn.innerText = "Copied!";
        setTimeout(()=>{ btn.innerText = old; }, 1800);
      });
    }
  </script>
</body>
</html>
